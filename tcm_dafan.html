<style>
    ul,
    menu,
    dir {
        display: block;
        list-style-type: disc;
        -webkit-margin-before: 1em;
        -webkit-margin-after: 1em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
        -webkit-padding-start: 40px;
    }
</style>
<script src="tcmdafan.js"></script>
<script src="tcmfufandict.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>

    function addLabel(parent, text) {
        label = $("<label>")
        label.text(text)
        parent.append(label)
        return label
    }
    function addLink(parent, text, url) {
        link = $("<a>")
        link.text(text)
        link.prop("href", url)
        parent.append(link)
        return label
    }
    function addLine(parent) {
        line = $("<hr>")
        parent.append(line)
    }
    function addSubTitle(parent, text) {
        addNextLine(main)
        addLabel(parent, text)
    }
    function addSubTitleAndLabel(parent, title, text, separator = "，", isFufan = false) {
        span = $("<div>")
        addLabel(span, title)
        addBlank(span)
        if (text.indexOf(separator) != -1) {
            addList(span, text, separator, isFufan)
        } else if (text.indexOf("◦") != -1) {
            addList(span, text, "◦", isFufan)
        } else {
            if (text.trim() == "") {
                text = "N/A"
            }
            addLabel(span, text.replace("•", "").replace("–", "").replace("|", "").replace("◦", "").replace("–", ""))
        }
        parent.append(span)
    }
    function addList(parent, text, separator, isFufan = false) {
        list = text.split(separator)
        ul = $("<ul>")
        for (i = 0; i < list.length; i++) {
            if (list[i].trim() == "") {
                continue
            }
            li = $("<li>")
            content = list[i].trim().replace("•", "").replace("–", "").replace("|", "").replace("◦", "").replace("–", "")
            if (isFufan) {
                array = content.split("=>")
                if (fufandict[array[0]] === undefined) {
                    li.text(content)
                } else {
                    li.html("<a href='" + fufandict[array[0]] + "'>" + array[0] + "</a>=>" + array[1])
                }
            } else {
                li.text(content)
            }
            ul.append(li)
        }
        parent.append(ul)
        return ul
    }
    function addBlank(parent) {
        parent.append("<label>&nbsp;</label>")
    }
    function addNextLine(parent) {
        parent.append("<br/>")
    }
    function addGroupSeperator(parent) {
        parent.append("<label>&nbsp;->&nbsp;</label>")
    }
    function getDiv(dict) {
        main = $("<div>")
        addLabel(main, dict["NAME"])
        addBlank(main)
        addLink(main, dict["PINYIN_NAME"], dict["URL"])
        addBlank(main)
        addLabel(main, "( " + dict["LATIN_NAME"] + " )")
        addBlank(main)
        addNextLine(main)
        addSubTitleAndLabel(main, "Common Name:", dict["COMMON_NAME"])
        addNextLine(main)
        addSubTitleAndLabel(main, "Literal English:", dict["LITERAL_ENGLISH"])
        addNextLine(main)
        addLabel(main, dict["SUBJECT"])
        addNextLine(main)
        addLabel(main, dict["GROUP"])
        addGroupSeperator(main)
        addLabel(main, dict["SUBGROUP_1"])
        addGroupSeperator(main)
        addLabel(main, dict["SUBGROUP_2"])
        addNextLine(main)
        addSubTitleAndLabel(main, "Channels:", dict["CHANNELS"])
        addSubTitleAndLabel(main, "Properties:", dict["PROPERTIES"])
        addSubTitleAndLabel(main, "Actions & Indications:", dict["ACTIONS_INDICATIONS"], separator = "•")
        addSubTitleAndLabel(main, "Dosage:", dict["DOSAGE"])
        addNextLine(main)
        addSubTitleAndLabel(main, "Common Combinations:", dict["COMMON_COMBINATIONS"], separator = "•")
        addSubTitleAndLabel(main, "Others:", dict["OTHERS"], separator = "|")
        addSubTitleAndLabel(main, "Fufan:", dict["FUFAN"], separator = "|", isFufan = true)
        return main
    }

    function initChannelsDropDownList(channels) {
        select = $("<select id='channel'></select>")
        opt = $("<option value='none'>Please select a option</option>")
        select.append(opt)
        opt = $("<option value='all'>All</option>")
        select.append(opt)
        for (i = 0; i < channels.length; i++) {
            val = channels[i]
            opt = $("<option value='" + val + "'>" + val + "</option>")
            select.append(opt)
        }
        $("#funcArea").append(select);
    }

    function initChannelsCheckboxes(channels) {
        container = $("#funcArea")
        for (i = 0; i < channels.length; i++) {
            val = channels[i]
            $('<input />', { type: 'checkbox', id: 'cb' + i, class: 'channelcbs', value: val }).appendTo(container);
            $('<label />', { 'for': 'cb' + i, text: val }).appendTo(container);
        }
        $(".channelcbs").change(function () {
            list = checkBoxesHandler()
            showList($("#mainDiv"), list)
        })
    }

    function dropdownListHandler() {
        list = []
        if (channel == "all") {
            list = dafanList;
        } else if (channel != "none") {
            for (j = 0; j < dafanList.length; j++) {
                channels = dafanList[j]["CHANNELS"]
                if (channels === undefined) {
                    continue
                }
                console.log(channel, channels)
                if (channels.indexOf(channel) != -1) {
                    list.push(dafanList[j])
                }
            }
        }
        return list
    }

    function checkBoxesHandler() {
        list = []
        var $boxes = $('input[type=checkbox]:checked');
        searchChannels = []
        $boxes.each(function () {
            //console.log($(this).val())
            searchChannels.push($(this).val())
        });
        if (searchChannels.length == 0) {
            list = dafanList;
        } else {
            //console.log(searchChannels.length)
            for (j = 0; j < dafanList.length; j++) {
                channels = dafanList[j]["CHANNELS"]
                isAdd = true
                console.log(channels)
                for (k = 0; k < searchChannels.length; k++) {
                    channel = searchChannels[k]
                    console.log(channel, channels)
                    if (channels.indexOf(channel) == -1) {
                        isAdd = false
                        break
                    }
                }
                if (isAdd) {
                    list.push(dafanList[j])
                }
            }
        }
        return list
    }

    function showList(area, list) {
        area.empty()//Remoive all children
        for (ii = 0; ii < list.length; ii++) {
            div = getDiv(list[ii])
            area.append(div)
            addLine(area)
        }
    }
    channels = ["LR", "LU", "ST", "BL", "HT", "KI", "ST", "SP", "GV"]
    $(function () {
        initChannelsCheckboxes(channels)
        //initChannelsDropDownList(channels)
        /*$("#search").click(function () {
            //channel = $("#channel").val()
            //console.log(channel)
            //list = dropdownListHandler()
            list = checkBoxesHandler()
            showList($("#mainDiv"), list)
        })*/
        $("#clear").click(function () {
            $(".channelcbs").prop("checked", "")
            list = checkBoxesHandler()
            showList($("#mainDiv"), list)

        })
    });

</script>

<body>
    <div id="funcArea">


    </div>
    <!-- <button id="search">Search</button><br> -->
    <button id="clear">Clear</button><br>
    <div id="mainDiv">

    </div>

</body>